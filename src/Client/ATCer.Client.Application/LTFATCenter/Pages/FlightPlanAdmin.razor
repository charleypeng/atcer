@page "/atcer/ltfatcenter/fligh-plan-admin"
@namespace ATCer.LTFATCenter.Client.Pages
@inherits ListTableBase<FlightPlanDto, long, FlightPlanEdit>
@inject NavigationManager NavigationManager
@inject HttpClient HttpClien
@inject Services.Test1 test1
@using ATCer.Client.Interops
@using ATCer.Client.Components
@using System.Net.Http.Json
@inject UserOptions userSettings

<div>
   <Tabs>
     <TabPane Key="3">
        <TabTemplate>就是R43DSFA</TabTemplate>
        <ChildContent>
             <span><Button OnClick="Click">Lock</Button></span>
@*             <span><DepStatBarAnt @ref="rom" Width="600" Height="400" Data="data1"></DepStatBarAnt></span>*@
             <span><MECharts @ref="Mychart" Option="_option" Dark=@userSettings.DarkMode></MECharts></span>
             <span><MECharts @ref="Mychart2" Option="optBar" Dark=@userSettings.DarkMode></MECharts></span>
        </ChildContent>
    </TabPane>
    <TabPane Key="1">
        <TabTemplate>FDSAFE</TabTemplate>
        <ChildContent>
            @*<div>
              <Button Type="@ButtonType.Primary" Icon="plus" OnClick="OnChartAdd">
                 好的 反对法
              </Button>
            </div>
            <div>
              <Card>
                <AntDesign.Charts.Line @ref="chart1"  Data="data" Config="config"/>
              </Card>
            </div>     *@
        </ChildContent>
    </TabPane>
    
    <TabPane Key="4">
        <TabTemplate>haha</TabTemplate>
        <ChildContent>
            @*<TinySidBar  @ref=bt2 Data=data2 Title="你3231" Width="122"></TinySidBar>  *@
        </ChildContent>
    </TabPane>
    <TabPane Key="2">
        <TabTemplate>飞行计划</TabTemplate>
        <ChildContent>
            <Table @ref="_table"
                TItem="FlightPlanDto"
                DataSource="@_datas"
                Total="_total"
                OnChange="@OnChange"
                @bind-PageIndex="_pageIndex"
                @bind-PageSize="_pageSize"
                @bind-SelectedRows="_selectedRows"
                Loading="@_tableIsLoading"
                Context="model">
            <TitleTemplate>
            <ResourceAuthorize ResourceKey="atcer_ltfatcenter">
                <TableSearch TDto="FlightPlanDto" OnSearchFieldChanged="SetPresetFilterGroups" OnSearch="ReLoadTable" DefaultValue="_defaultSearchValue"></TableSearch>
            </ResourceAuthorize>
            <Row>
                <AntDesign.Col Span="8">
                    <ResourceAuthorize ResourceKey="atcer_ltfatcenter">
                        <Button Type="@ButtonType.Primary" Icon="delete" Danger OnClick="OnClickDeletes" Loading="_deletesBtnLoading">
                            @localizer["删除选中"]
                        </Button>
                    </ResourceAuthorize>
                </AntDesign.Col>
                <AntDesign.Col Span="16" Style="text-align:right">
                    <Space>
                        <ResourceAuthorize ResourceKey="atcer_ltfatcenter">
                            <SpaceItem>
                                <Button Type="@ButtonType.Primary" Icon="plus" OnClick="OnClickAdd">
                                    @localizer["添加"]
                                </Button>
                            </SpaceItem>
                        </ResourceAuthorize>
                        <ResourceAuthorize ResourceKey="atcer_ltfatcenter">
                            <SpaceItem>
                                <Button Type="@ButtonType.Primary" Icon="reload" OnClick="ReLoadTable">
                                    @localizer["刷新"]
                                </Button>
                            </SpaceItem>
                        </ResourceAuthorize>
                    </Space>
                </AntDesign.Col>
            </Row>
        </TitleTemplate>
        <RowTemplate>
            <ResourceAuthorize ResourceKey="atcer_ltfatcenter">
                <Selection Key="@(model.Id.ToString())" />
            </ResourceAuthorize>
            <Column @bind-Field="@model.FlightType" Filterable />
            <Column @bind-Field="@model.Callsign" Filterable />
            <Column @bind-Field="@model.WTC" Width="10%" Filters="FunctionWakeTurbulenceFilters">
                <TagPro Text="model.WTC"></TagPro>
            </Column>
            <Column @bind-Field="@model.EOBT" Filterable />
            <Column @bind-Field="@model.ATOT" Filterable />
            <Column @bind-Field="@model.ALDT" Filterable />
            <Column @bind-Field="@model.PlanState" Width="10%" Filters="FunctionPlanStatusFilters">
                <TagPro Text="model.PlanState"></TagPro>
            </Column>
            <Column @bind-Field="@model.RegMarking" Filterable/>
            <Column @bind-Field="@model.CreatedTime" Format="@ClientConstant.DateTimeFormat" Sortable DefaultSortOrder="@SortDirection.Descending" />
            <ActionColumn>
                <Space>
                    <ResourceAuthorize ResourceKey="atcer_ltfatcenter">
                        <SpaceItem>
                            <Tooltip Title="@(localizer["编辑"])" ArrowPointAtCenter="true">
                                <Button Icon="edit" Type="@ButtonType.Primary" Size="@ClientConstant.OperationButtonSize" OnClick="()=>OnClickEdit(model.Id)"></Button>
                            </Tooltip>
                        </SpaceItem>
                    </ResourceAuthorize>
                    <ResourceAuthorize ResourceKey="atcer_ltfatcenter">
                        <SpaceItem>
                            <Tooltip Title="@(localizer["详情"])" ArrowPointAtCenter="true">
                                <Button Icon="eye" Type="@ButtonType.Primary" Size="@ClientConstant.OperationButtonSize" OnClick="()=>OnClickDetail(model.Id)"></Button>
                            </Tooltip>
                        </SpaceItem>
                    </ResourceAuthorize>
                    <ResourceAuthorize ResourceKey="atcer_ltfatcenter">
                        <SpaceItem>
                            <Tooltip Title="@(localizer["删除"])" ArrowPointAtCenter="true">
                                <Button Icon="delete" Type="@ButtonType.Primary" Danger OnClick="()=>OnClickDelete(model.Id)"></Button>
                            </Tooltip>
                        </SpaceItem>
                    </ResourceAuthorize>
                </Space>
            </ActionColumn>
        </RowTemplate>
    </Table>
        </ChildContent>
    </TabPane>
   </Tabs>
</div>

@code{
    private object _option = new
    {
        backgroundColor = "",
        Title = new
        {
            Left = "center",
            Text = "ECharts 入门示例"
        },
        Tooltip = new { },
        Legend = new
        {
            Right = "20px",
            Data = new[] { "销量" }
        },
        XAxis = new
        {
            Data = new[] { "衬衫", "羊毛衫", "雪纺衫", "裤子", "高跟鞋", "袜子" }
        },
        YAxis = new { },
        Series = new[]
         {
            new
            {
                Name= "销量",
                Type= "bar",
                Data= new []{ 5, 20, 36, 10, 10, 20 }
            }
     }
    };

    object optBar =  new
    {
        backgroundColor = "",
        xAxis = new { max = "dataMax" },
        max = "dataMax",
        yAxis = new
        {
            type = "category",
            data = new[] {"北向", "西向", "南向", "东向" },
            inverse = true,
            animationDuration = 300,
            animationDurationUpdate = 300,
            max = 10
        },
        series = new[]
             {
                 new
                 {
                    realtimeSort = true,
                    seriesLayoutBy = "column",
                    name = "风纪扣",
                    type = "bar",
                    data = new object[]{new { value = 20, itemStyle=new { color = "#bc002d"} },30,17,15 },
                    label = new
                    {
                        show = true,
                        position = "right",
                        valueAnimation = true
                    }, 
                 }
      },
        legend = new
        {
            show = true
        },
        animationDuration = 0,
        animationDurationUpdate = 1000,
        animationEasing = "linear",
        animationEasingUpdate = "linear"
    };

    static List<int> lst = new List<int> { 5, 20, 36, 10, 10, 20 };
    int count=55;
    async Task Click()
    {
        var rockstar = new
        {
            Title = new
            {
                Left = "center",
                Text = "热望热望看"
            },
            Series = new[]
         {
            new
            {
                Name= "销量",
                Type= "bar",
                Data= new []{ 234, 456, 344, 2344, 2343, 23432 }
            }
     }
        };

        var rockstar2 = new
        {
            Series = new[]
            {
                new
                {
                    Type= "bar",
                    data = new object[]{new { value = 15, itemStyle=new { color = "#bc002d"} },24,27,17 },
                }
            }   
        };

        if(Mychart != null)
        {
            await Mychart.SetOption(rockstar);
        }

        if (Mychart2 != null)
        {
            await Mychart2.SetOption(rockstar2);
        }
        //dataWow = dataWow +count;
        //count ++;


        //data1.Find(x=>x.Name=="西北").Sale = 800000+count;
        //count = count + 100000;
        //await rom?.RefreshData();
    }
    class ee {
        public string Name { get; set; }
        public double Sale { get; set; }
    }
    List<ee> data1 = new List<ee>
    {
        new ee{Name = "华东", Sale = 4684506.442},
        new ee{Name = "中南", Sale = 4137415.0929999948},
        new ee{Name = "东北", Sale = 2681567.469000001},
        new ee{Name = "华北", Sale = 2447301.017000004},
        new ee{Name = "西南", Sale = 1303124.508000002},
        new ee{Name = "西北", Sale = 815039.5959999998}
    };
    IChartCom rom;
}